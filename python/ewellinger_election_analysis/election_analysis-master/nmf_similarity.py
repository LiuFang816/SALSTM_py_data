import pandas as pd
import numpy as np
from NMF_Clustering import NMFClustering
from sklearn.metrics.pairwise import pairwise_distances
from progressbar import ProgressBar
import matplotlib.pyplot as plt
plt.style.use('ggplot')


def nmf_similarity(df, num_topics):
    print 'Processing {} Topics...'.format(num_topics)
    nmf = NMFClustering(num_topics, tfidf_max_features=5000, tfidf_max_df=0.75, random_state=42)
    nmf.fit(df)
    print 'Clustering Done...'
    pbar = ProgressBar()
    tfidf_similarity = []
    num_zero = 0
    for topic in pbar(xrange(num_topics)):
        # When looking at high numbers of topics, it is possible for no points to be assigned to that topic, in which case pairwise_distances() will throw an error.  The label should also be skipped if only one article is assigned as pairwise_distances will return nan
        if nmf.labels[:, topic].sum() > 1:
            cosine_dist = pairwise_distances(nmf.tfidf_matrix[nmf.labels[:, topic]], metric='cosine', n_jobs=-1)
            idx = np.tril_indices(cosine_dist.shape[0], k=-1)
            tfidf_similarity.append(1 - cosine_dist[idx].mean())
        else:
            num_zero += 1
    topic_similarity = pairwise_distances(nmf.nmf.components_, metric='cosine', n_jobs=1)
    idx = np.tril_indices(topic_similarity.shape[0], k=-1)
    if num_zero:
        print 'Number of Empty Topics: {}'.format(num_zero)
    print '\n'
    return np.mean(tfidf_similarity), 1 - topic_similarity[idx].mean(), nmf.nmf.reconstruction_err_, num_zero


def make_similarity_plot(n_topics, tfidf_similarity, topic_similarity, reconst_err, num_zero, x=None, fname='plots/nmf_similarity.png', save=True):
    fig = plt.figure(figsize=(12, 10))

    ax1 = fig.add_subplot(411)
    ax1.plot(n_topics, topic_similarity)
    plt.setp(ax1.get_xticklabels(), visible=False)
    plt.title('Between Topics', fontsize=11)

    ax2 = fig.add_subplot(412, sharex=ax1)
    plt.plot(n_topics, tfidf_similarity)
    plt.setp(ax2.get_xticklabels(), visible=False)
    plt.title('Articles Within Topics', fontsize=11)

    ax3 = fig.add_subplot(413, sharex=ax1)
    plt.plot(n_topics, reconst_err)
    plt.setp(ax3.get_xticklabels(), visible=False)

    ax4 = fig.add_subplot(414, sharex=ax1)
    plt.plot(n_topics, num_zero)

    ax1.set_ylabel('Avg Cosine Similarity')
    ax2.set_ylabel('Avg Cosine Similarity')
    ax3.set_ylabel('Reconstruction Error')
    ax4.set_ylabel('Number of Empty Topics')
    plt.xlabel('Number of Topics')

    if x:
        ax1.axvline(x=x, color='#4c72b0', linestyle='--')
        ax2.axvline(x=x, color='#4c72b0', linestyle='--')
        ax3.axvline(x=x, color='#4c72b0', linestyle='--')
        ax4.axvline(x=x, color='#4c72b0', linestyle='--')
    plt.suptitle('Cosine Similarity of NMF Model', fontsize=18, x=0.52)
    plt.subplots_adjust(left=0.08, right=0.97, bottom=0.07, top=0.92, hspace=0.16)
    # plt.tight_layout()
    if fname:
        plt.savefig(fname, dpi=500)
        plt.close()


if __name__=='__main__':
    df = pd.read_pickle('election_data.pkl')

    # n_topics = range(2, 120)  + range(120, 200, 2) + range(200, 400, 5) + range(400, 501, 10)
    # similarity = [nmf_similarity(df, n_topic) for n_topic in n_topics]
    # tfidf_similarity = np.array(zip(*similarity)[0])
    # topic_similarity = np.array(zip(*similarity)[1])
    # reconst_err = np.array(zip(*similarity)[2])
    # num_zero = np.array(zip(*similarity)[3])

    # Generated these values by running the above code on an AWS instance
    # Generated using nmf = NMFClustering(tfidf_max_features=10000, tfidf_max_df=0.8)
    # n_topics = range(2, 120)  + range(120, 200, 2) + range(200, 300, 5) + range(300, 500, 10)
    # tfidf_similarity = np.array([ 0.07241204,  0.08067165,  0.08111483,  0.08402468,  0.08397889,
    #         0.08882869,  0.08928822,  0.09055349,  0.09273816,  0.09400491,
    #         0.0931941 ,  0.09603154,  0.09510582,  0.09879016,  0.0992579 ,
    #         0.09948934,  0.10339638,  0.10373623,  0.10618623,  0.10395435,
    #         0.10456381,  0.1056184 ,  0.1091172 ,  0.10946842,  0.1089448 ,
    #         0.11084343,  0.11078609,  0.1123428 ,  0.11374788,  0.11106599,
    #         0.11431787,  0.11618255,  0.1161894 ,  0.11718566,  0.11632887,
    #         0.11668448,  0.11681521,  0.11841483,  0.11851557,  0.11822323,
    #         0.11897914,  0.12022045,  0.11969195,  0.1185778 ,  0.12110431,
    #         0.12075395,  0.12218741,  0.1215595 ,  0.12417451,  0.12331804,
    #         0.12355963,  0.12356608,  0.12420396,  0.12504559,  0.12489918,
    #         0.12556189,  0.12668058,  0.12698913,  0.12685605,  0.12830635,
    #         0.12855729,  0.12799086,  0.13290281,  0.13138817,  0.13167119,
    #         0.1307781 ,  0.13051511,  0.13632275,  0.13200778,  0.13309584,
    #         0.13308315,  0.13395304,  0.13868152,  0.13412891,  0.13948069,
    #         0.13841124,  0.13952709,  0.13683903,  0.14171278,  0.13666098,
    #         0.14133219,  0.13841064,  0.13868718,  0.1377494 ,  0.14363093,
    #         0.13848451,  0.13828318,  0.14529842,  0.14242831,  0.14471221,
    #         0.14625302,  0.14623265,  0.14311148,  0.14651197,  0.14229339,
    #         0.14692008,  0.14369016,  0.14415179,  0.14696634,  0.14894499,
    #         0.14477734,  0.14799911,  0.14581528,  0.14805686,  0.15213815,
    #         0.15114227,  0.15006068,  0.15275545,  0.14786021,  0.15050873,
    #         0.15182426,  0.15045126,  0.15162808,  0.15316264,  0.15260427,
    #         0.15344267,  0.15295611,  0.15199405,  0.15509141,  0.15537893,
    #         0.15574572,  0.15670038,  0.15606494,  0.15604411,  0.15811363,
    #         0.15846973,  0.15665362,  0.15824544,  0.1596564 ,  0.16091131,
    #         0.16247118,  0.1612889 ,  0.16283788,  0.16342476,  0.16163312,
    #         0.16336977,  0.16379681,  0.16476496,  0.16551407,  0.16548602,
    #         0.16335721,  0.16645326,  0.16795859,  0.16809291,  0.1664389 ,
    #         0.16775292,  0.16794246,  0.16905802,  0.1688391 ,  0.17042498,
    #         0.17034883,  0.17252342,  0.17179349,  0.17069648,  0.17154945,
    #         0.17375064,  0.17145106,  0.17390472,  0.17468701,  0.17579511,
    #         0.17488493,  0.17716952,  0.1772454 ,  0.17746182,  0.1793806 ,
    #         0.17898087,  0.18168633,  0.1802443 ,  0.18269892,  0.18153248,
    #         0.18198824,  0.18245133,  0.18408391,  0.1841588 ,  0.1823694 ,
    #         0.18342187,  0.18277587,  0.18432153,  0.18434262,  0.18646492,
    #         0.18142537,  0.18375346,  0.18452003,  0.18206167,  0.18436599,
    #         0.18526836,  0.18532242,  0.18269651,  0.18408388,  0.18280546,
    #         0.18031327,  0.1787032 ,  0.18012824,  0.17941206,  0.18051384,
    #         0.17857422,  0.17739165,  0.17924929])
    # topic_similarity = np.array([ 0.48175808,  0.35969408,  0.30268244,  0.26061526,  0.21553519,
    #         0.19867059,  0.17431647,  0.1695465 ,  0.16758452,  0.14238672,
    #         0.14244975,  0.13592443,  0.12133374,  0.11675137,  0.1104067 ,
    #         0.11096589,  0.09615196,  0.09286034,  0.09192836,  0.09263339,
    #         0.09300293,  0.08082325,  0.07974773,  0.07617059,  0.077886  ,
    #         0.07217608,  0.06941329,  0.0644513 ,  0.06506072,  0.06585726,
    #         0.06444667,  0.06208396,  0.05919808,  0.05802671,  0.05818001,
    #         0.05471487,  0.05583186,  0.05429249,  0.05245915,  0.05259367,
    #         0.05010044,  0.05040057,  0.05037151,  0.04830328,  0.04713662,
    #         0.04848067,  0.04512875,  0.04555011,  0.04437763,  0.04255682,
    #         0.04309551,  0.04304514,  0.0427118 ,  0.040154  ,  0.04278433,
    #         0.04165907,  0.038795  ,  0.03790447,  0.03721742,  0.03873809,
    #         0.03614853,  0.03741072,  0.03625366,  0.0370956 ,  0.03609413,
    #         0.03452013,  0.03462409,  0.03444836,  0.0341728 ,  0.0334566 ,
    #         0.03395155,  0.03328395,  0.03178548,  0.03241834,  0.03198357,
    #         0.03092008,  0.0314571 ,  0.03188229,  0.03107001,  0.03094987,
    #         0.03042475,  0.03031736,  0.02968979,  0.02956764,  0.02885874,
    #         0.02850756,  0.02872543,  0.02885102,  0.0278739 ,  0.02704047,
    #         0.02838199,  0.0271071 ,  0.02711865,  0.02654346,  0.0267635 ,
    #         0.02649694,  0.02663309,  0.02555343,  0.02538249,  0.02538675,
    #         0.02574525,  0.02431164,  0.02515789,  0.02556346,  0.02457752,
    #         0.02427718,  0.02466239,  0.02385928,  0.0234345 ,  0.02392136,
    #         0.02303674,  0.02325547,  0.02360916,  0.02189685,  0.02259953,
    #         0.02220356,  0.02285778,  0.02098455,  0.02152605,  0.02110438,
    #         0.02162684,  0.02089287,  0.02084138,  0.019897  ,  0.0194296 ,
    #         0.01912407,  0.01896952,  0.01856231,  0.01863061,  0.0183473 ,
    #         0.01824505,  0.01786235,  0.01745208,  0.01780592,  0.01697823,
    #         0.01664856,  0.01678494,  0.01656961,  0.01648673,  0.01627983,
    #         0.01564524,  0.0153094 ,  0.01562635,  0.01531365,  0.01517866,
    #         0.01504619,  0.01457172,  0.01477113,  0.01448706,  0.01402278,
    #         0.01431557,  0.01379982,  0.0133312 ,  0.01373544,  0.01315589,
    #         0.01329391,  0.01293711,  0.01343571,  0.01293907,  0.01257149,
    #         0.01229408,  0.01176287,  0.01123712,  0.01117922,  0.01119672,
    #         0.01061634,  0.01048306,  0.00999544,  0.00990419,  0.00983667,
    #         0.00923251,  0.00929287,  0.00893437,  0.00830286,  0.00808173,
    #         0.00774235,  0.00761957,  0.00743553,  0.00731256,  0.00725261,
    #         0.0063825 ,  0.00609158,  0.00559025,  0.00536236,  0.00501713,
    #         0.00466952,  0.00436606,  0.00402217,  0.00389107,  0.00369759,
    #         0.00343503,  0.00331605,  0.00309118,  0.00290579,  0.00285968,
    #         0.00263017,  0.00255821,  0.00241811])
    # reconst_err = np.array([ 140.01617149,  139.15165644,  138.49038066,  137.87818207,
    #         137.45442142,  136.90954731,  136.48887062,  136.17533868,
    #         135.7365993 ,  135.38145365,  135.08027989,  134.7041473 ,
    #         134.46685839,  134.10395867,  133.79366031,  133.62315961,
    #         133.18298735,  132.96221041,  132.64298368,  132.51267328,
    #         132.3114863 ,  131.98905801,  131.75025046,  131.45206496,
    #         131.33299113,  130.99320229,  130.81712321,  130.61770605,
    #         130.42705534,  130.45521586,  130.08965348,  129.85868764,
    #         129.74529097,  129.56556111,  129.41365037,  129.29866917,
    #         129.08327952,  128.92260562,  128.73370862,  128.69725334,
    #         128.41184414,  128.25176545,  128.15510128,  128.11441288,
    #         127.9234971 ,  127.83687639,  127.5589785 ,  127.44907932,
    #         127.3961424 ,  127.15759086,  127.09378492,  126.91919864,
    #         126.84120295,  126.67904611,  126.58220317,  126.51395581,
    #         126.3473571 ,  126.21758824,  126.08358756,  125.96839136,
    #         125.93630865,  125.74244048,  125.79789693,  125.49452429,
    #         125.50669383,  125.33425911,  125.17435975,  125.13384328,
    #         125.01543299,  124.94825269,  124.82250862,  124.75896302,
    #         124.63837947,  124.55452952,  124.44221941,  124.46842187,
    #         124.40989168,  124.25521519,  124.21644965,  124.04110318,
    #         123.94732596,  123.887368  ,  123.79734489,  123.64498907,
    #         123.63184528,  123.50633211,  123.47207183,  123.36030791,
    #         123.28802274,  123.19334364,  123.10341066,  123.08656938,
    #         122.90223648,  122.82283692,  122.80551984,  122.72453751,
    #         122.6917355 ,  122.56246226,  122.51721989,  122.4399558,
    #         122.35353005,  122.27665618,  122.20009227,  122.12684515,
    #         122.0117161 ,  122.01794974,  121.89736249,  121.81176418,
    #         121.8084999 ,  121.75041819,  121.64021483,  121.59765988,
    #         121.50775799,  121.37501879,  121.39537066,  121.30280293,
    #         121.24093113,  121.20832381,  121.06387438,  120.94645482,
    #         120.89744141,  120.75149813,  120.56955705,  120.44127786,
    #         120.35486408,  120.25616603,  120.06694659,  119.97644546,
    #         119.87304736,  119.71769951,  119.57385207,  119.53447131,
    #         119.47571136,  119.27767241,  119.15079251,  119.08372542,
    #         118.91367027,  118.87827544,  118.78346029,  118.6072047 ,
    #         118.60286888,  118.42140611,  118.37210978,  118.2393147 ,
    #         118.17432507,  118.04194154,  117.92588629,  117.88061081,
    #         117.7393507 ,  117.62485036,  117.63638224,  117.4356683 ,
    #         117.3670615 ,  117.37345674,  117.16490982,  117.11205085,
    #         117.02619291,  116.89220075,  116.82276394,  116.64824524,
    #         116.42571519,  116.19757283,  115.92587956,  115.69425416,
    #         115.58097621,  115.56262354,  115.20106776,  114.94884292,
    #         114.95538267,  114.75152863,  114.70235233,  114.65796451,
    #         114.3932966 ,  114.44169682,  114.32428788,  114.21054879,
    #         114.37731935,  114.02442959,  114.12591426,  113.6887655 ,
    #         114.11902418,  113.91945629,  114.33472288,  114.10108741,
    #         114.27012016,  114.34747186,  114.32172332,  114.5553678 ,
    #         114.76923926,  114.76124315,  115.04969096,  115.21902281,
    #         115.26714148,  115.26787468,  115.02616502,  115.49899949,
    #         115.47466988,  115.46548624])
    #
    # make_similarity_plot(n_topics, tfidf_similarity, topic_similarity, reconst_err, x=300)


    # Generated these values by running the above code on an AWS instance
    # Generated using nmf = NMFClustering(tfidf_max_features=8000, tfidf_max_df=0.75, random_state=42)
    # n_topics = range(2, 120)  + range(120, 200, 2) + range(200, 400, 5) + range(400, 501, 10)
    # tfidf_similarity = np.array([ 0.07515538,  0.08347299,  0.08654952,  0.08683519,  0.08950472,
    #     0.09012165,  0.09364081,  0.09482573,  0.09407337,  0.09422253,
    #     0.09729319,  0.1002924 ,  0.10067457,  0.10252551,  0.10488646,
    #     0.10619383,  0.10778357,  0.10862441,  0.10820786,  0.1076053 ,
    #     0.10838636,  0.11410822,  0.11437935,  0.11030746,  0.1157084 ,
    #     0.11395457,  0.11591851,  0.11626313,  0.11594323,  0.11817782,
    #     0.11613662,  0.11873421,  0.11889517,  0.12002258,  0.11977559,
    #     0.12030629,  0.12213292,  0.12119627,  0.12215037,  0.12172281,
    #     0.12274719,  0.12290974,  0.12454396,  0.12397918,  0.1240907 ,
    #     0.12462401,  0.12475954,  0.12582311,  0.12646057,  0.12831852,
    #     0.12675626,  0.12829751,  0.12736151,  0.12930581,  0.13125709,
    #     0.12999494,  0.13147952,  0.13111356,  0.13203288,  0.13185692,
    #     0.13197555,  0.13228761,  0.1354578 ,  0.13506401,  0.13564949,
    #     0.1346118 ,  0.13994817,  0.13497727,  0.13696049,  0.13627113,
    #     0.1422621 ,  0.13795103,  0.14213202,  0.13924222,  0.13904504,
    #     0.14090895,  0.14101068,  0.1412111 ,  0.14013319,  0.14101449,
    #     0.14247043,  0.14680025,  0.14051716,  0.14684533,  0.14476647,
    #     0.14682784,  0.14472622,  0.14627313,  0.14417126,  0.14930381,
    #     0.14614801,  0.14966322,  0.14977971,  0.1483729 ,  0.15062784,
    #     0.1524314 ,  0.15320339,  0.15456842,  0.14822687,  0.15432776,
    #     0.15387988,  0.15326201,  0.15280602,  0.1543711 ,  0.15489209,
    #     0.15375712,  0.15145306,  0.15391491,  0.15685061,  0.15673076,
    #     0.15691469,  0.15286652,  0.15770811,  0.15775144,  0.15681182,
    #     0.15925055,  0.15570051,  0.15478675,  0.15614657,  0.16151978,
    #     0.16091526,  0.1612053 ,  0.1613958 ,  0.16350693,  0.16451954,
    #     0.16422851,  0.16335563,  0.16486548,  0.16472303,  0.16435752,
    #     0.16488366,  0.16882872,  0.16621838,  0.16804844,  0.16943919,
    #     0.1669644 ,  0.16971389,  0.16880064,  0.17054642,  0.17197838,
    #     0.1712846 ,  0.17082536,  0.17263872,  0.17362067,  0.17393136,
    #     0.17339183,  0.17469983,  0.17419949,  0.17442471,  0.17633788,
    #     0.17527418,  0.1756044 ,  0.17646987,  0.17567921,  0.17629456,
    #     0.17781013,  0.17727404,  0.17760444,  0.17859355,  0.18073744,
    #     0.18062512,  0.18122056,  0.18432567,  0.18386026,  0.18395135,
    #     0.1847255 ,  0.18618567,  0.18505182,  0.18628093,  0.1871458 ,
    #     0.18610439,  0.18837986,  0.18889304,  0.19041203,  0.19128175,
    #     0.18858767,  0.19167344,  0.19016527,  0.19162032,  0.19136951,
    #     0.19280768,  0.18910657,  0.18936451,  0.19055657,  0.19089522,
    #     0.19068891,  0.1884677 ,  0.19087331,  0.18886187,  0.18775818,
    #     0.1911949 ,  0.188554  ,  0.18950405,  0.18738808,  0.1876369 ,
    #     0.18905141,  0.18751053,  0.18805593,  0.18976413,  0.18615772,
    #     0.18614163,  0.18478065,  0.18530513,  0.18537739,  0.18572425,
    #     0.18493226,  0.18472718,  0.18608778,  0.18288508])
    # topic_similarity = np.array([ 0.48210725,  0.36032574,  0.29466197,  0.26170806,  0.2323785,
    #     0.19757244,  0.17884203,  0.16375801,  0.16804737,  0.1485457 ,
    #     0.14242659,  0.13457116,  0.12223219,  0.11857836,  0.11132819,
    #     0.1004082 ,  0.09937158,  0.09102658,  0.09674861,  0.0924392 ,
    #     0.09170919,  0.07974085,  0.07738878,  0.07917459,  0.07621856,
    #     0.074443  ,  0.06904413,  0.0680281 ,  0.06718213,  0.06402193,
    #     0.06199848,  0.06297925,  0.06057362,  0.05841103,  0.06028942,
    #     0.05752458,  0.0545122 ,  0.05380055,  0.05377727,  0.05260457,
    #     0.05140544,  0.04984985,  0.05029782,  0.04943875,  0.04741162,
    #     0.04786565,  0.04681735,  0.04491583,  0.04488832,  0.04406147,
    #     0.04402126,  0.04266182,  0.04139339,  0.0411684 ,  0.04174674,
    #     0.04045509,  0.04032052,  0.03990642,  0.03880883,  0.0372476 ,
    #     0.03739464,  0.03668389,  0.03781747,  0.03600187,  0.03603276,
    #     0.03576769,  0.03539206,  0.03412039,  0.03429158,  0.03439269,
    #     0.03332296,  0.03211563,  0.03172369,  0.03285317,  0.03251906,
    #     0.03204478,  0.03163888,  0.03121346,  0.03051331,  0.03008099,
    #     0.03083751,  0.03017501,  0.02934732,  0.02893644,  0.02965335,
    #     0.02833332,  0.02916777,  0.02932288,  0.027068  ,  0.02758465,
    #     0.02718763,  0.02741371,  0.0274272 ,  0.02707668,  0.02632478,
    #     0.02710531,  0.02708707,  0.02578969,  0.02617683,  0.02582499,
    #     0.02501282,  0.02587711,  0.02468236,  0.0251918 ,  0.02577187,
    #     0.02420118,  0.02393263,  0.02436713,  0.02419252,  0.02289236,
    #     0.02282979,  0.02327704,  0.02329752,  0.02302406,  0.02214678,
    #     0.02180877,  0.02233266,  0.02149443,  0.02186591,  0.02120974,
    #     0.02054673,  0.02093218,  0.02031477,  0.01971648,  0.02021474,
    #     0.01982619,  0.0195176 ,  0.019875  ,  0.01868287,  0.01862136,
    #     0.01786979,  0.0182288 ,  0.01755849,  0.01778048,  0.01749574,
    #     0.01764525,  0.01712547,  0.01667005,  0.01712795,  0.01630412,
    #     0.01631116,  0.01546142,  0.01570413,  0.01549243,  0.0150396 ,
    #     0.0154583 ,  0.01473962,  0.01441823,  0.0144081 ,  0.01445908,
    #     0.01386555,  0.013818  ,  0.01381761,  0.01347825,  0.01341608,
    #     0.01335158,  0.01305704,  0.01304929,  0.01307709,  0.01278364,
    #     0.01245015,  0.01188493,  0.01173852,  0.01102929,  0.01106137,
    #     0.01067224,  0.01045081,  0.00987744,  0.00971963,  0.00942041,
    #     0.00908151,  0.0090931 ,  0.00885804,  0.00883421,  0.00829377,
    #     0.00797704,  0.00773706,  0.00755022,  0.0075025 ,  0.00694195,
    #     0.00703341,  0.00661893,  0.00632505,  0.00615406,  0.00615046,
    #     0.00591955,  0.00547697,  0.00551829,  0.00537096,  0.00504611,
    #     0.00508969,  0.00463429,  0.00469397,  0.00456959,  0.00422953,
    #     0.00423924,  0.00401885,  0.00386583,  0.00389622,  0.0036272 ,
    #     0.00331855,  0.00322338,  0.00305535,  0.00291402,  0.00279348,
    #     0.00264878,  0.00247255,  0.00242048,  0.00225998])
    # reconst_err = np.array([ 139.78040465,  138.88810871,  138.24923654,  137.5742522 ,
    #     137.06704785,  136.71017379,  136.47823922,  135.75447663,
    #     135.36966096,  135.08205083,  134.66381645,  134.28397975,
    #     133.99525894,  133.67819169,  133.31556129,  133.13672556,
    #     132.69153274,  132.39140423,  132.21747686,  132.04584342,
    #     131.82315585,  131.35859751,  131.11130396,  131.04389574,
    #     130.67419918,  130.53765077,  130.26216139,  130.02608406,
    #     129.88564234,  129.63389145,  129.5696351 ,  129.29748348,
    #     129.14256457,  128.95104555,  128.86764148,  128.65666645,
    #     128.45997899,  128.26055996,  128.16376026,  128.01055999,
    #     127.80466427,  127.71458275,  127.61009922,  127.44142031,
    #     127.23341915,  127.07760536,  126.93756668,  126.82391462,
    #     126.67036974,  126.59828711,  126.41427004,  126.26963019,
    #     126.10519368,  126.09542904,  125.87520026,  125.8012909 ,
    #     125.59688044,  125.474132  ,  125.44835605,  125.2647636 ,
    #     125.1695771 ,  125.06128249,  124.96648092,  124.78155481,
    #     124.62551915,  124.59537272,  124.54410798,  124.42326303,
    #     124.30429805,  124.23126662,  124.04094327,  123.95968711,
    #     123.93881435,  123.77479246,  123.8220388 ,  123.64003067,
    #     123.45581973,  123.40241636,  123.34340921,  123.21556371,
    #     123.18697656,  123.04459263,  122.97093071,  122.86127604,
    #     122.80601613,  122.71526376,  122.60181427,  122.54888889,
    #     122.46517041,  122.37403437,  122.27244035,  122.16044937,
    #     122.20067289,  122.02950917,  121.92247415,  121.89243017,
    #     121.81013804,  121.74034111,  121.68693204,  121.60031133,
    #     121.46207966,  121.5053941 ,  121.36972858,  121.33983445,
    #     121.2682851 ,  121.16212798,  121.11168132,  121.06626966,
    #     121.01789554,  120.85893379,  120.7378028 ,  120.71617607,
    #     120.60841828,  120.49989966,  120.48747154,  120.34152874,
    #     120.36980905,  120.22863909,  120.20894147,  119.98939741,
    #     119.95009621,  119.80396228,  119.67263021,  119.57355924,
    #     119.43338367,  119.24680577,  119.21539336,  119.0517041 ,
    #     118.98356172,  118.87628314,  118.66640327,  118.53796888,
    #     118.46632639,  118.28664707,  118.23108676,  118.13318667,
    #     118.03964105,  117.89956846,  117.83383637,  117.72509712,
    #     117.5072488 ,  117.39753834,  117.38204204,  117.22064703,
    #     117.09996227,  117.09730512,  116.9016303 ,  116.8028278 ,
    #     116.74864299,  116.6335283, 116.53511098,  116.50064079,  116.35929584,  116.26628919,
    #     116.15131406,  116.02091747,  115.96265086,  115.93569503,
    #     115.78520502,  115.58723298,  115.3352458 ,  115.07945321,
    #     114.85386276,  114.73346481,  114.41401757,  114.32923479,
    #     114.04444976,  113.87715686,  113.89491647,  113.69584474,
    #     113.70426621,  113.46178556,  113.38664892,  113.12870454,
    #     112.9127761 ,  113.09656853,  113.04353893,  113.02645589,
    #     112.82563132,  112.91187865,  112.76311327,  112.9136414 ,
    #     113.02858036,  113.01514644,  112.87585543,  113.06097449,
    #     113.06912658,  113.04156985,  112.92617581,  113.60119139,
    #     113.0765163 ,  113.52208403,  112.95674802,  113.25669763,
    #     113.38486255,  113.74053907,  113.85845979,  113.85802755,
    #     113.5064924 ,  113.75290852,  114.05615461,  114.35530984,
    #     113.94131805,  114.34519055,  114.12901007,  114.3084293 ,
    #     114.64303298,  114.33126313,  114.81256839])
    # make_similarity_plot(n_topics, tfidf_similarity, topic_similarity, reconst_err, x=300, fname='plots/nmf_similarity_8000.png')


    # Generated these values by running the above code on an AWS instance
    # Generated using nmf = NMFClustering(tfidf_max_features=5000, tfidf_max_df=0.75, random_state=42)
    n_topics = range(2, 120)  + range(120, 200, 2) + range(200, 400, 5) + range(400, 501, 10)
    tfidf_similarity = np.array([ 0.08282555,  0.09124129,  0.09440369,  0.09475352,  0.09939214,
        0.09893504,  0.09912087,  0.10142111,  0.10317778,  0.10513362,
        0.10708022,  0.10858522,  0.10918045,  0.11137536,  0.11090756,
        0.11235858,  0.11646844,  0.11889449,  0.11920686,  0.11880454,
        0.11850342,  0.11675729,  0.12382237,  0.12539354,  0.12283163,
        0.12528473,  0.12639585,  0.1253718 ,  0.12712334,  0.12535515,
        0.12850534,  0.12935052,  0.13044743,  0.12956599,  0.13119385,
        0.13106531,  0.12962289,  0.13290764,  0.13248151,  0.13240572,
        0.13236808,  0.13300167,  0.133916  ,  0.13529135,  0.13500911,
        0.13737973,  0.13652955,  0.13723394,  0.13709935,  0.13790217,
        0.13894832,  0.13895552,  0.13878906,  0.13956895,  0.14195653,
        0.14223673,  0.14219229,  0.14185   ,  0.14251177,  0.14349503,
        0.1448633 ,  0.14627648,  0.14443093,  0.14522622,  0.14528886,
        0.14701584,  0.14803625,  0.14778749,  0.14838954,  0.14869074,
        0.14877449,  0.15426301,  0.15108543,  0.15132124,  0.15137101,
        0.15589095,  0.1537124 ,  0.15370901,  0.15300392,  0.15563631,
        0.15504446,  0.15412784,  0.15357418,  0.15583802,  0.16065138,
        0.16108412,  0.16130144,  0.1609613 ,  0.15761166,  0.15969114,
        0.16429445,  0.16042106,  0.16494681,  0.15835423,  0.16090036,
        0.15973913,  0.16435309,  0.16546787,  0.16237327,  0.16249059,
        0.16029204,  0.16755842,  0.1664463 ,  0.16524566,  0.16481793,
        0.16720976,  0.16385973,  0.16622389,  0.16756167,  0.16727902,
        0.17032373,  0.17052751,  0.17065804,  0.16806089,  0.16877026,
        0.16624512,  0.17300331,  0.17459094,  0.1729143 ,  0.1734038 ,
        0.17549115,  0.17638216,  0.17022163,  0.17334491,  0.17782928,
        0.17716684,  0.17696366,  0.17854814,  0.1782385 ,  0.17889903,
        0.1806159 ,  0.17967728,  0.180771  ,  0.18136602,  0.18150675,
        0.18235338,  0.18201053,  0.1839397 ,  0.18326239,  0.18475703,
        0.18475727,  0.18583899,  0.18822085,  0.18660652,  0.18699789,
        0.18810348,  0.1864508 ,  0.18860915,  0.19022258,  0.19058313,
        0.19004525,  0.18952189,  0.18979516,  0.19062018,  0.19295672,
        0.1925268 ,  0.19380507,  0.19389109,  0.19385978,  0.19669268,
        0.19598268,  0.1960585 ,  0.19657396,  0.1979215 ,  0.19805133,
        0.2005871 ,  0.20194711,  0.20384236,  0.20252189,  0.20447604,
        0.20442573,  0.20354168,  0.20459862,  0.2040483 ,  0.2027384 ,
        0.20620909,  0.20556459,  0.20484734,  0.20610726,  0.20734932,
        0.20518601,  0.20568624,  0.20675579,  0.20438982,  0.20517438,
        0.20343483,  0.20128061,  0.20362168,  0.20387904,  0.20237506,
        0.20306449,  0.20505478,  0.20358721,  0.20319117,  0.20290676,
        0.20194845,  0.20462172,  0.20627083,  0.20372099,  0.20440746,
        0.20174437,  0.20173042,  0.20115454,  0.20187373,  0.19942632,
        0.1996386 ,  0.19919249,  0.19830332,  0.1982359 ])
    topic_similarity = np.array([ 0.48281408,  0.36169284,  0.29551529,  0.26307663,  0.21837337,
        0.20669768,  0.18466095,  0.16530042,  0.16167535,  0.13791002,
        0.14594075,  0.13123673,  0.12744278,  0.12183315,  0.11010433,
        0.10745624,  0.09997501,  0.09625205,  0.09269359,  0.09145695,
        0.08955144,  0.08989004,  0.08016664,  0.07744266,  0.07994132,
        0.07097265,  0.07166186,  0.06695528,  0.06826068,  0.0643375 ,
        0.06338229,  0.06219392,  0.06046137,  0.05981437,  0.05818055,
        0.05753405,  0.05676321,  0.05437156,  0.05395802,  0.05111276,
        0.05127945,  0.05203455,  0.04886075,  0.04944217,  0.04727091,
        0.04730541,  0.04621767,  0.04530776,  0.04415205,  0.04363343,
        0.04271108,  0.0430949 ,  0.04266226,  0.0429011 ,  0.04122596,
        0.03988622,  0.04153844,  0.03997285,  0.0385031 ,  0.03824031,
        0.03829062,  0.03592893,  0.03615975,  0.038253  ,  0.0353657 ,
        0.03706885,  0.03529773,  0.03621694,  0.03562157,  0.03353194,
        0.03289312,  0.03184735,  0.03219439,  0.03305339,  0.03174873,
        0.03172043,  0.03234785,  0.03154576,  0.03102237,  0.0305421 ,
        0.03073485,  0.0302049 ,  0.02991137,  0.02883012,  0.02871764,
        0.02901302,  0.02914264,  0.02860011,  0.0284864 ,  0.02842403,
        0.02802521,  0.02718956,  0.02717957,  0.02650214,  0.02536546,
        0.02711336,  0.02578346,  0.02719192,  0.02601369,  0.02523438,
        0.02472994,  0.02548399,  0.02545882,  0.0243897 ,  0.02468233,
        0.02470519,  0.02473867,  0.02354982,  0.02428742,  0.02373793,
        0.02390547,  0.02236883,  0.0228614 ,  0.02256661,  0.02345711,
        0.02153195,  0.02145292,  0.02256993,  0.02101297,  0.02185888,
        0.02098707,  0.02087589,  0.02089869,  0.01974586,  0.02029252,
        0.01980733,  0.01983093,  0.01833975,  0.01830185,  0.01793997,
        0.01834836,  0.01755109,  0.01811031,  0.01702084,  0.01671918,
        0.01714976,  0.01692184,  0.01722929,  0.01627398,  0.01603544,
        0.01562614,  0.01571256,  0.01547346,  0.01487731,  0.01503722,
        0.01496611,  0.01469215,  0.01421795,  0.0143419 ,  0.01410315,
        0.01375294,  0.01412448,  0.01393612,  0.01386623,  0.01325595,
        0.01311519,  0.01275623,  0.01308761,  0.01266979,  0.01271605,
        0.01226661,  0.01162606,  0.01143555,  0.01118657,  0.01080856,
        0.01053836,  0.01033174,  0.01002989,  0.00955188,  0.00945629,
        0.00913405,  0.0086377 ,  0.00846423,  0.00815295,  0.00797268,
        0.00790401,  0.007659  ,  0.00727243,  0.00702749,  0.00683285,
        0.00644916,  0.00652579,  0.00626265,  0.00596185,  0.00585659,
        0.00536646,  0.00528854,  0.00518468,  0.00504903,  0.00500437,
        0.00472644,  0.00479092,  0.00444951,  0.0043659 ,  0.00416817,
        0.00420412,  0.00409086,  0.0038607 ,  0.00387492,  0.00367784,
        0.00332253,  0.00320427,  0.0029979 ,  0.00273217,  0.00270143,
        0.00263249,  0.00240656,  0.00227751,  0.0021593 ])
    reconst_err = np.array([ 139.11070534,  138.13759186,  137.43495643,  136.70691588,
        136.3364777 ,  135.73819706,  135.2484045 ,  134.73591885,
        134.33752424,  133.96703851,  133.4942906 ,  133.16512569,
        132.85809748,  132.4517165 ,  132.13090095,  131.7925292 ,
        131.40486   ,  131.08621868,  130.76724557,  130.54183643,
        130.29974539,  130.19593952,  129.81275946,  129.44682488,
        129.53693379,  128.90771935,  128.7249271 ,  128.52921796,
        128.28043503,  128.19566073,  127.86496394,  127.61818059,
        127.46409414,  127.34473147,  127.05186925,  126.91702798,
        126.90022534,  126.59279726,  126.45628823,  126.22767536,
        126.11441802,  125.93489058,  125.79581069,  125.59338852,
        125.42073755,  125.2681576 ,  125.04168601,  124.93056388,
        124.74767698,  124.62461787,  124.4962466 ,  124.29319436,
        124.20283861,  124.04406557,  123.98490702,  123.70915809,
        123.6104744 ,  123.50401951,  123.40288437,  123.24418342,
        123.16180096,  123.05381092,  122.87324289,  122.79557698,
        122.69221597,  122.51969221,  122.39969032,  122.36572557,
        122.23895863,  122.03546341,  121.91485435,  121.97388663,
        121.72135007,  121.59044737,  121.54313839,  121.49942402,
        121.33241155,  121.16774129,  121.25531422,  121.00205432,
        120.90369217,  120.85566694,  120.74601062,  120.62987207,
        120.56453366,  120.48661295,  120.30066362,  120.31184484,
        120.10844386,  120.08756996,  119.97503506,  119.87393668,
        119.75421227,  119.7993981 ,  119.57963009,  119.5747924 ,
        119.48377935,  119.48493591,  119.23539035,  119.18321471,
        119.1575053 ,  119.04477464,  118.90673011,  118.91162741,
        118.89716324,  118.66747755,  118.70932259,  118.59698113,
        118.49638846,  118.47129518,  118.21671653,  118.15211279,
        118.15066512,  118.03885096,  117.99934229,  117.98354908,
        117.74384906,  117.67287104,  117.66891256,  117.55015576,
        117.32236825,  117.21570179,  117.08998525,  116.89890559,
        116.81702421,  116.61750976,  116.48676178,  116.44488838,
        116.2208883 ,  116.05316601,  115.98441444,  115.82895595,
        115.78797968,  115.58353586,  115.47314343,  115.44251124,
        115.1841427 ,  115.15689157,  114.93516184,  114.87195045,
        114.75364604,  114.58313008,  114.45700824,  114.3782491 ,
        114.27134177,  114.155126  ,  114.05182191,  113.95716298,
        113.83521899,  113.65585155,  113.63138973,  113.45683063,
        113.36167929,  113.2508183 ,  113.22255982,  113.03083765,
        112.9403948 ,  112.91482132,  112.73443139,  112.4537981 ,
        112.15267994,  111.99679449,  111.80113439,  111.60475367,
        111.37168653,  111.25557203,  111.01255856,  110.82134166,
        110.40519358,  110.53443878,  110.30596993,  110.26443917,
        110.32882815,  110.12931948,  109.98492114,  109.8101767 ,
        109.98334511,  109.88129554,  109.6155129 ,  109.879562  ,
        109.97073745,  109.86090202,  109.47331863,  109.90624898,
        109.53711746,  110.49605354,  110.38673964,  110.55454515,
        110.25970425,  109.99380688,  110.17722437,  110.05902077,
        110.68251494,  110.35010312,  110.89465483,  110.51456225,
        110.44743662,  110.48638223,  110.25027839,  110.6702175 ,
        110.84990607,  110.88507705,  111.12146646,  111.59908366,
        111.72110431,  111.43671616,  111.59933954,  111.71536648,
        111.69577226])
    num_zero = np.array([  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   2,   2,   4,   4,   4,   2,
         8,   9,  14,  20,  19,  22,  22,  32,  35,  35,  45,  51,  53,
        51,  66,  63,  90,  90, 100,  97,  96, 107, 109, 126, 125, 141,
       137, 141, 149, 149, 166, 180, 191, 206, 226, 239, 242, 257, 271, 279])
    make_similarity_plot(n_topics, tfidf_similarity, topic_similarity, reconst_err, num_zero, x=250, fname='plots/nmf_similarity.png')
